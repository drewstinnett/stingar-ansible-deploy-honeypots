---

- name: Look up config information
  shell: curl http://localhost:9200/config/_search | jq .hits.hits[-1]._source
  register: config_info

- debug:
    var: config_info

- name: Create required directories
  file:
    path: "{{ stingar_base }}"
    state: directory

- name: Download honeypot deployments
  git:
    repo: "{{ stingar_hp_repo }}"
    dest: "{{ stingar_base }}/stingar-honeypots"

- name: Copy in docker-compose stuff
  template:
    src: "{{ item }}.j2"
    dest: "{{ stingar_base }}/{{ item }}"
  with_items:
    - "stingar.env"
    - "docker-compose.yaml"

- name: Start up containers
  docker_service:
    project_src: "{{ stingar_base }}"
